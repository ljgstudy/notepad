### 延时队列

---

#### 1、什么是延时队列

延时队列顾名思义，即放置在该队列里面的消息是不需要立即消费的，而是等待一段时间之后取出消费。

- 关闭空闲连接。服务器中，有很多客户端的连接，空闲一段时间之后需要关闭之。
- 清理过期数据业务上。比如缓存中的对象，超过了空闲时间，需要从缓存中移出。
- 任务超时处理。在网络协议滑动窗口请求应答式交互时，处理超时未响应的请求。
- 下单之后如果三十分钟之内没有付款就自动取消订单。
- 订餐通知:下单成功后60s之后给用户发送短信通知。
- 当订单一直处于未支付状态时，如何及时的关闭订单，并退还库存？
- 如何定期检查处于退款状态的订单是否已经退款成功？
- 新创建店铺，N天内没有上传商品，系统如何知道该信息，并发送激活短信？
- 定时任务调度：使用DelayQueue保存当天将会执行的任务和执行时间，一旦从DelayQueue中获取到任务就开始执行。

#### 2、实现延时队列的方式

- 利用两个特性： Time To Live(TTL)、Dead Letter Exchanges（DLX）
- 利用RabbitMQ中的插件x-delay-message
- 定期轮询（数据库等）
- 其他方式
  - Timer
  - ScheduledExecutorService
  - 时间轮(kafka)
  - RabbitMQ
  - Quartz
  - Redis Zset
  - Koala
  - JCronTab
  - SchedulerX（阿里）
  - 有赞延迟队列

#### 3、整合springboot

TODO

#### 参考资料

https://juejin.im/post/5b5e52ecf265da0f716c3203

